<!DOCTYPE html>
<html>
<head>
Â  Â  <title>API ë™ê¸°í™” í™€ì§ ê²°ê³¼ í‘œì‹œê¸°</title>
Â  Â  <meta charset="UTF-8">
Â  Â  <style>
Â  Â  Â  Â  /* ------------------ ìŠ¤íƒ€ì¼ (CSS) ------------------ */
Â  Â  Â  Â  body { margin: 0; padding: 0; background-color: #f9f9f9; font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
Â  Â  Â  Â  #result-container {
Â  Â  Â  Â  Â  Â  border: 3px solid #4A90E2;
Â  Â  Â  Â  Â  Â  padding: 30px 40px;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  max-width: 400px;Â 
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 20px; }
Â  Â  Â  Â  #currentResult {Â 
Â  Â  Â  Â  Â  Â  font-size: 70px;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  Â  Â  transition: color 0.5s ease-in-out;
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .odd { color: #e74c3c; /* í™€ìˆ˜: ë¹¨ê°• */ }
Â  Â  Â  Â  .even { color: #337ab7; /* ì§ìˆ˜: íŒŒë‘ */ }
Â  Â  Â  Â  .time-label {Â 
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  Â  font-size: 24px;Â 
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  margin-top: -10px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #timer { font-size: 36px; font-weight: bold; color: #4A90E2; margin-top: 15px; margin-bottom: 10px; }
Â  Â  Â  Â  #nextCycle { font-size: 16px; color: #666; }
Â  Â  Â  Â  .info { font-size: 14px; color: #999; margin-top: 20px; }
Â  Â  Â  Â  /* ------------------------------------------------ */
Â  Â  </style>
</head>
<body>
<div id="result-container">
Â  Â  <div class="header">ğŸ² KST 4ë¶„ ì£¼ê¸° í™€ì§ ê²°ê³¼ (API ë™ê¸°í™”)</div>
Â  Â  <div id="currentResult" class="odd">
Â  Â  Â  Â  -
Â  Â  Â  Â  <span id="resultTime" class="time-label">-</span>
Â  Â  </div>
Â  Â  <div id="timer">ë¡œë”© ì¤‘...</div>
Â  Â  <div id="nextCycle"></div>
Â  Â  <div class="info">â€» ì´ ê²°ê³¼ëŠ” ì™¸ë¶€ ì„œë²„ ì‹œê°„(KST)ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.</div>
</div>

<script>
// JavaScript ë¡œì§ (API ê¸°ë°˜ ë™ê¸°í™” ê³„ì‚°)
const CYCLE_DURATION_MS = 4 * 60 * 1000; // 4ë¶„ ì£¼ê¸°
const API_URL = 'https://worldtimeapi.org/api/timezone/Asia/Seoul';

let nextCycleTimer;
let timeGap = 0; // ì„œë²„ ì‹œê°„ê³¼ ë¡œì»¬ ì‹œê°„ì˜ ì°¨ì´ (ë°€ë¦¬ì´ˆ)
let lastApiUpdateTime = 0; // ë§ˆì§€ë§‰ìœ¼ë¡œ API ì‹œê°„ì„ ë°›ì€ ë¡œì»¬ ì‹œê°„

// ğŸ†• ë³€ê²½ëœ ë‚œìˆ˜ ìƒì„±ê¸°: xorshiftì™€ ë¹„ìŠ·í•œ ì›ë¦¬ë¥¼ ì‚¬ìš©í•œ ê²°ì •ë¡ ì  ë‚œìˆ˜ ìƒì„± (PRNG)
// ì‹œë“œ(currentSeed)ì— ë”°ë¼ í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
function prng(seed) {
    // 64ë¹„íŠ¸ ì‹œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚œìˆ˜ í’ˆì§ˆ ê°œì„  (ì‹œë“œëŠ” Math.floor(kstTime / CYCLE_DURATION_MS))
    // JavaScriptëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ìˆ«ìë¥¼ 64ë¹„íŠ¸ ë¶€ë™ì†Œìˆ˜ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ë§Œ,
    // ë¹„íŠ¸ ì—°ì‚°ì„ í†µí•´ 32ë¹„íŠ¸ ì •ìˆ˜ ì—°ì‚°ì²˜ëŸ¼ ë³´ì´ê²Œ ì²˜ë¦¬í•˜ì—¬ ê²°ì •ë¡ ì  ê²°ê³¼ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
    let x = BigInt(seed);
    
    x ^= x << 13n; // ì¢Œì¸¡ ì´ë™
    x ^= x >> 7n; // ìš°ì¸¡ ì´ë™
    x ^= x << 17n; // ì¢Œì¸¡ ì´ë™
    
    // 64ë¹„íŠ¸ BigIntë¥¼ 0ë¶€í„° 1 ì‚¬ì´ì˜ ë¶€ë™ì†Œìˆ˜ì ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
    // 2^53 (Number.MAX_SAFE_INTEGER)ë¡œ ë‚˜ëˆ„ì–´ ë¶€ë™ì†Œìˆ˜ì ì˜ ì •ë°€ë„ í•œê³„ ë‚´ì—ì„œ ë‚œìˆ˜ ìƒì„±
    const maxSafeInt = BigInt(Math.pow(2, 53));
    
    // ê²°ê³¼ê°€ ìŒìˆ˜ê°€ ë˜ì§€ ì•Šë„ë¡ ì ˆëŒ€ê°’ì„ ì·¨í•˜ê±°ë‚˜, 0xFFFFFFFFFFFFFFFFn ë§ˆìŠ¤í¬ë¥¼ ì”Œìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ BigInt(Math.abs(Number(x)))ë¡œ ì²˜ë¦¬í•˜ê³ , ë¶€ë™ì†Œìˆ˜ì ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    // x % maxSafeIntë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚œìˆ˜ ë²”ìœ„ë¥¼ ì œí•œí•©ë‹ˆë‹¤.
    const result = Number(x % maxSafeInt);
    
    // 0 ì´ìƒ maxSafeInt ë¯¸ë§Œì˜ ê°’ì„ maxSafeIntë¡œ ë‚˜ëˆ„ì–´ [0, 1) ë²”ìœ„ì˜ ë‚œìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    return (result < 0 ? result + Number(maxSafeInt) : result) / Number(maxSafeInt);
}

// ğŸ”´ ì™¸ë¶€ API (WorldTimeAPI)ë¥¼ í†µí•´ í˜„ì¬ KST ì‹œê°„ì„ ê°€ì ¸ì˜¤ê³  timeGapì„ ê³„ì‚°
async function calculateTimeGap() {
    try {
Â  Â  Â  Â  const response = await fetch(API_URL);
Â  Â  Â  Â  if (!response.ok) throw new Error('API ì‘ë‹µ ì‹¤íŒ¨');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ì„œë²„ì—ì„œ ë°›ì€ ì •í™•í•œ KST ì‹œê°„ (íƒ€ì„ìŠ¤íƒ¬í”„)
Â  Â  Â  Â  const serverTimeMs = new Date(data.datetime).getTime();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // í˜„ì¬ ë¸Œë¼ìš°ì €ì˜ ë¡œì»¬ ì‹œê°„ (API ìš”ì²­ í›„ ì‘ë‹µ ë°›ì€ ì‹œì )
Â  Â  Â  Â  const nowLocalTimeMs = new Date().getTime();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ì„œë²„ ì‹œê°„ê³¼ ë¡œì»¬ ì‹œê°„ì˜ ì°¨ì´ ê³„ì‚° (ì´ ì°¨ì´ê°€ timeGapì…ë‹ˆë‹¤.)
Â  Â  Â  Â  timeGap = serverTimeMs - nowLocalTimeMs;
Â  Â  Â  Â  lastApiUpdateTime = nowLocalTimeMs;
Â  Â  Â  Â Â 
Â  Â  Â  Â  return serverTimeMs;

Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("Time API í˜¸ì¶œ ì˜¤ë¥˜ ë°œìƒ:", e);
Â  Â  Â  Â  // API ì‹¤íŒ¨ ì‹œ, timeGapì„ 0ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë¡œì»¬ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•˜ê²Œ í•©ë‹ˆë‹¤.
Â  Â  Â  Â  timeGap = 0;
Â  Â  Â  Â  lastApiUpdateTime = new Date().getTime();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // UTC ì‹œê°„ + KST ì˜¤í”„ì…‹ìœ¼ë¡œ ë¡œì»¬ KST ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  const KST_OFFSET_MS = 9 * 60 * 60 * 1000;
Â  Â  Â  Â  const utcTime = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
Â  Â  Â  Â  return utcTime + KST_OFFSET_MS;
Â  Â  }
}

// ğŸ”´ ë³´ì •ëœ KST ì‹œê°„ì„ ì–»ëŠ” í•¨ìˆ˜
function getCorrectedKSTTime(nowLocalTimeMs) {
Â  Â  // ë¡œì»¬ ì‹œê°„ + íƒ€ì„ ê°­ = ì„œë²„ ë³´ì • ì‹œê°„. timeGapì´ 0ì´ë©´ ë¡œì»¬ ì‹œê°„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
Â  Â  return nowLocalTimeMs + timeGap;
}


// ì‹œê°„ ë™ê¸°í™” ë° ê²°ê³¼ ê³„ì‚° (TimeGap ì‚¬ìš©)
function getSynchronizedResult(kstTime) {
Â  Â  const currentSeed = Math.floor(kstTime / CYCLE_DURATION_MS);
Â  Â Â 
Â  Â  // í˜„ì¬ íšŒì°¨ ì‹œì‘ ì‹œê° ê³„ì‚° (4ë¶„ ì£¼ê¸°ì˜ ì‹œì‘ ì‹œì )
Â  Â  const currentCycleStartTimeMs = currentSeed * CYCLE_DURATION_MS;
Â  Â  const currentCycleStartTime = new Date(currentCycleStartTimeMs);

Â  Â  const nextCycleTimeMs = (currentSeed + 1) * CYCLE_DURATION_MS;
Â  Â  const nextCycleDate = new Date(nextCycleTimeMs);
Â  Â Â 
Â  Â  // ğŸ†• ë³€ê²½ëœ PRNG í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë‚œìˆ˜ ê²°ì •
Â  Â  const prngValue = prng(currentSeed);
Â  Â  
Â  Â  // ë‚œìˆ˜ ìƒì„± ë²”ìœ„ëŠ” 1~100ìœ¼ë¡œ ë™ì¼í•˜ê²Œ ìœ ì§€
Â  Â  const randomNumber = Math.floor(prngValue * 100) + 1;
Â  Â Â 
Â  Â  const isOdd = randomNumber % 2 !== 0;
Â  Â  const result = isOdd ? 'í™€' : 'ì§';

Â  Â  // í‘œì‹œí•  ì‹œê° í¬ë§·
Â  Â  const timeDisplay = currentCycleStartTime.toLocaleTimeString('ko-KR', {
Â  Â  Â  Â  year: '2-digit', month: '2-digit', day: '2-digit',Â 
Â  Â  Â  Â  hour: '2-digit', minute: '2-digit', hour12: false,Â 
Â  Â  Â  Â  timeZone: 'Asia/Seoul'
Â  Â  }).replace(/\.\s/g, '.').replace(' ', ' ');

Â  Â  return {Â 
Â  Â  Â  Â  nextCycleTime: nextCycleDate,Â 
Â  Â  Â  Â  result,Â 
Â  Â  Â  Â  timeDisplay,
Â  Â  Â  Â  kstTime // ë³´ì •ëœ KST ì‹œê°„ì„ ë°˜í™˜í•˜ì—¬ ë‹¤ìŒ ê³„ì‚°ì— ì‚¬ìš©
Â  Â  };
}

// UI ì—…ë°ì´íŠ¸
async function updateDisplay() {
Â  Â  const nowLocalTimeMs = new Date().getTime();
Â  Â Â 
Â  Â  // ğŸ”´ 5ì´ˆë§ˆë‹¤ APIë¥¼ í˜¸ì¶œí•˜ì—¬ TimeGapì„ ì¬ê³„ì‚°í•©ë‹ˆë‹¤. (ë¡œì»¬ ì‹œê°„ ì¡°ì‘ ë°©ì§€)
Â  Â  const API_REFRESH_INTERVAL = 5000;
Â  Â  if (nowLocalTimeMs - lastApiUpdateTime >= API_REFRESH_INTERVAL || lastApiUpdateTime === 0) {
Â  Â  Â  Â  await calculateTimeGap();Â 
Â  Â  }

Â  Â  // ğŸ”´ í˜„ì¬ ë³´ì •ëœ KST ì‹œê°„ ê³„ì‚°
Â  Â  const kstTime = getCorrectedKSTTime(nowLocalTimeMs);

Â  Â  // ê²°ê³¼ ê³„ì‚°
Â  Â  const { nextCycleTime, result, timeDisplay } = getSynchronizedResult(kstTime);

Â  Â  // ë‚¨ì€ ì‹œê°„ ê³„ì‚°
Â  Â  const diffMs = nextCycleTime.getTime() - kstTime;
Â  Â Â 
Â  Â  if (diffMs <= 0) {
Â  Â  Â  Â  // ì£¼ê¸°ê°€ ëë‚¬ê±°ë‚˜ ì‹œê°„ì´ ë§ì§€ ì•ŠëŠ” ê²½ìš°, ì¦‰ì‹œ ì¬ì‹œì‘í•˜ì—¬ ìƒˆ ì£¼ê¸° ë¡œë“œ
Â  Â  Â  Â  initResultDisplay();Â 
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const minutes = Math.floor(diffMs / (60 * 1000));
Â  Â  const seconds = Math.floor((diffMs % (60 * 1000)) / 1000);

Â  Â  const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
Â  Â Â 
Â  Â  const resultDiv = document.getElementById('currentResult');
Â  Â  const timeLabelDiv = document.getElementById('resultTime');
Â  Â  const timerDiv = document.getElementById('timer');
Â  Â  const cycleDiv = document.getElementById('nextCycle');

Â  Â  // ê²°ê³¼ í‘œì‹œ: í™€/ì§
Â  Â  resultDiv.firstChild.textContent = result;
Â  Â  resultDiv.className = result === 'í™€' ? 'odd' : 'even';
Â  Â Â 
Â  Â  // ì‹œê°„ í‘œì‹œ: YY.MM.DD HH:MM
Â  Â  timeLabelDiv.textContent = timeDisplay;
Â  Â Â 
Â  Â  // íƒ€ì´ë¨¸ ë° ë‹¤ìŒ íšŒì°¨ ì‹œê° í‘œì‹œ
Â  Â  timerDiv.textContent = timeString;
Â  Â  cycleDiv.textContent =Â 
Â  Â  Â  Â  `ë‹¤ìŒ ê²°ê³¼ ë³€ê²½ ì‹œê°: ${nextCycleTime.toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit' })}`;
}

// ì´ˆê¸°í™”
function initResultDisplay() {
Â  Â  if (nextCycleTimer) {
Â  Â  Â  Â  clearInterval(nextCycleTimer);
Â  Â  }
Â  Â Â 
Â  Â  // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
Â  Â  nextCycleTimer = setInterval(updateDisplay, 1000);
Â  Â  // ì²« ì‹¤í–‰
Â  Â  updateDisplay();
}

window.onload = initResultDisplay;
</script>
</body>
</html>
