<!DOCTYPE html>
<html>
<head>
    <title>API ë™ê¸°í™” í™€ì§ ê²°ê³¼ í‘œì‹œê¸° (1ì´ˆ ì£¼ê¸°)</title>
    <meta charset="UTF-8">
    <style>
        /* ------------------ ìŠ¤íƒ€ì¼ (CSS) ------------------ */
        body { margin: 0; padding: 0; background-color: #f9f9f9; font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #result-container {
            border: 3px solid #4A90E2;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            max-width: 400px; 
            background-color: white;
        }
        .header { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 20px; }
        #currentResult { 
            font-size: 70px; 
            font-weight: bold; 
            margin: 10px 0;
            transition: color 0.5s ease-in-out;
            display: block; 
        }
        .odd { color: #e74c3c; /* í™€ìˆ˜: ë¹¨ê°• */ }
        .even { color: #337ab7; /* ì§ìˆ˜: íŒŒë‘ */ }
        .time-label { 
            display: block; 
            font-size: 24px; 
            font-weight: normal;
            color: #666;
            margin-top: -10px; 
        }
        #timer { font-size: 36px; font-weight: bold; color: #4A90E2; margin-top: 15px; margin-bottom: 10px; }
        #nextCycle { font-size: 16px; color: #666; }
        .info { font-size: 14px; color: #999; margin-top: 20px; }
        /* ------------------------------------------------ */
    </style>
</head>
<body>
<div id="result-container">
    <div class="header">ğŸ² KST 1ì´ˆ ì£¼ê¸° í™€ì§ ê²°ê³¼ (API ë™ê¸°í™”)</div>
    <div id="currentResult" class="odd">
        -
        <span id="resultTime" class="time-label">-</span>
    </div>
    <div id="timer">00:00</div>
    <div id="nextCycle"></div>
    <div class="info">â€» ì´ ê²°ê³¼ëŠ” ì™¸ë¶€ ì„œë²„ ì‹œê°„(KST)ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤. (1ì´ˆë§ˆë‹¤ ê²°ê³¼ ë³€ê²½)</div>
</div>

<script>
// JavaScript ë¡œì§ (API ê¸°ë°˜ ë™ê¸°í™” ê³„ì‚°)
// ğŸ”´ 4ë¶„ ì£¼ê¸°ì—ì„œ 1ì´ˆ ì£¼ê¸°ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
const CYCLE_DURATION_MS = 1000; // 1ì´ˆ ì£¼ê¸°
const API_URL = 'https://worldtimeapi.org/api/timezone/Asia/Seoul';

let nextCycleTimer;
let timeGap = 0; // ì„œë²„ ì‹œê°„ê³¼ ë¡œì»¬ ì‹œê°„ì˜ ì°¨ì´ (ë°€ë¦¬ì´ˆ)
let lastApiUpdateTime = 0; // ë§ˆì§€ë§‰ìœ¼ë¡œ API ì‹œê°„ì„ ë°›ì€ ë¡œì»¬ ì‹œê°„

// ê²°ì •ë¡ ì  ë‚œìˆ˜ ìƒì„±ê¸°
function lcgRandom(seed) {
    seed = (seed * 1664525 + 1013904223) & 0xFFFFFFFF; 
    return seed / 4294967296;
}

// ğŸ”´ ì™¸ë¶€ API (WorldTimeAPI)ë¥¼ í†µí•´ í˜„ì¬ KST ì‹œê°„ì„ ê°€ì ¸ì˜¤ê³  timeGapì„ ê³„ì‚°
async function calculateTimeGap() {
    try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('API ì‘ë‹µ ì‹¤íŒ¨');
        
        const data = await response.json();
        const serverTimeMs = new Date(data.datetime).getTime(); 
        const nowLocalTimeMs = new Date().getTime();
        
        // ì„œë²„ ì‹œê°„ê³¼ ë¡œì»¬ ì‹œê°„ì˜ ì°¨ì´ ê³„ì‚°
        timeGap = serverTimeMs - nowLocalTimeMs;
        lastApiUpdateTime = nowLocalTimeMs;
        
        return serverTimeMs;

    } catch (e) {
        console.error("Time API í˜¸ì¶œ ì˜¤ë¥˜ ë°œìƒ: ë¡œì»¬ ì‹œê°„ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.", e);
        timeGap = 0;
        lastApiUpdateTime = new Date().getTime();
        
        const now = new Date();
        const KST_OFFSET_MS = 9 * 60 * 60 * 1000;
        const utcTime = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
        return utcTime + KST_OFFSET_MS;
    }
}

// ğŸ”´ ë³´ì •ëœ KST ì‹œê°„ì„ ì–»ëŠ” í•¨ìˆ˜
function getCorrectedKSTTime(nowLocalTimeMs) {
    // ë¡œì»¬ ì‹œê°„ + íƒ€ì„ ê°­ = ì„œë²„ ë³´ì • ì‹œê°„
    return nowLocalTimeMs + timeGap;
}


// ì‹œê°„ ë™ê¸°í™” ë° ê²°ê³¼ ê³„ì‚° (TimeGap ì‚¬ìš©)
function getSynchronizedResult(kstTime) {
    // 1ì´ˆ ë‹¨ìœ„ë¡œ ì‹œë“œ ê²°ì •
    const currentSeed = Math.floor(kstTime / CYCLE_DURATION_MS);
    
    // í˜„ì¬ íšŒì°¨ ì‹œì‘ ì‹œê° ê³„ì‚° (1ì´ˆ ì£¼ê¸°ì˜ ì‹œì‘ ì‹œì )
    const currentCycleStartTimeMs = currentSeed * CYCLE_DURATION_MS;
    const currentCycleStartTime = new Date(currentCycleStartTimeMs);

    const nextCycleTimeMs = (currentSeed + 1) * CYCLE_DURATION_MS;
    const nextCycleDate = new Date(nextCycleTimeMs);
    
    // ì‹œë“œë¥¼ ì´ìš©í•´ ë‚œìˆ˜ ê²°ì •
    const prngValue = lcgRandom(currentSeed);
    const randomNumber = Math.floor(prngValue * 100) + 1;
    
    const isOdd = randomNumber % 2 !== 0;
    const result = isOdd ? 'í™€' : 'ì§';

    // í‘œì‹œí•  ì‹œê° í¬ë§· (1ì´ˆ ë‹¨ìœ„ë¡œ í‘œì‹œ)
    const timeDisplay = currentCycleStartTime.toLocaleTimeString('ko-KR', {
        year: '2-digit', month: '2-digit', day: '2-digit', 
        hour: '2-digit', minute: '2-digit', second: '2-digit', // ì´ˆë‹¨ìœ„ ì¶”ê°€
        hour12: false, 
        timeZone: 'Asia/Seoul'
    }).replace(/\.\s/g, '.').replace(' ', ' ');

    return { 
        nextCycleTime: nextCycleDate, 
        result, 
        timeDisplay,
        kstTime 
    };
}

// UI ì—…ë°ì´íŠ¸
async function updateDisplay() {
    const nowLocalTimeMs = new Date().getTime();
    
    // 5ì´ˆë§ˆë‹¤ APIë¥¼ í˜¸ì¶œí•˜ì—¬ TimeGapì„ ì¬ê³„ì‚°í•©ë‹ˆë‹¤.
    const API_REFRESH_INTERVAL = 5000;
    if (nowLocalTimeMs - lastApiUpdateTime >= API_REFRESH_INTERVAL || lastApiUpdateTime === 0) {
        // API í˜¸ì¶œì€ ë¹„ë™ê¸°ì´ë¯€ë¡œ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        await calculateTimeGap(); 
    }

    // í˜„ì¬ ë³´ì •ëœ KST ì‹œê°„ ê³„ì‚°
    const kstTime = getCorrectedKSTTime(nowLocalTimeMs);

    // ê²°ê³¼ ê³„ì‚°
    const { nextCycleTime, result, timeDisplay } = getSynchronizedResult(kstTime);

    // ë‚¨ì€ ì‹œê°„ ê³„ì‚° (1ì´ˆ ì£¼ê¸°ì´ë¯€ë¡œ, ë‹¤ìŒ ì£¼ê¸°ê¹Œì§€ ë‚¨ì€ ì‹œê°„ì€ í•­ìƒ 1ì´ˆ ë¯¸ë§Œì…ë‹ˆë‹¤.)
    const diffMs = nextCycleTime.getTime() - kstTime;
    
    if (diffMs <= 0) {
        initResultDisplay(); 
        return;
    }

    // 1ì´ˆ ì£¼ê¸°ì— ë§ì¶° ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
    const milliseconds = Math.floor(diffMs).toString().padStart(3, '0');

    const timeString = `00.${milliseconds}`; // (00ì´ˆ.ë°€ë¦¬ì´ˆ)ë¡œ í‘œì‹œ

    const resultDiv = document.getElementById('currentResult');
    const timeLabelDiv = document.getElementById('resultTime');
    const timerDiv = document.getElementById('timer');
    const cycleDiv = document.getElementById('nextCycle');

    // ê²°ê³¼ í‘œì‹œ: í™€/ì§
    resultDiv.firstChild.textContent = result;
    resultDiv.className = result === 'í™€' ? 'odd' : 'even';
    
    // ì‹œê°„ í‘œì‹œ: YY.MM.DD HH:MM:SS
    timeLabelDiv.textContent = timeDisplay;
    
    // íƒ€ì´ë¨¸ ë° ë‹¤ìŒ íšŒì°¨ ì‹œê° í‘œì‹œ
    timerDiv.textContent = timeString;
    // 1ì´ˆ ì£¼ê¸°ì´ë¯€ë¡œ ë‹¤ìŒ íšŒì°¨ ì‹œê°ì€ í˜„ì¬ ì‹œê°ì˜ ë‹¤ìŒ ì´ˆì…ë‹ˆë‹¤.
    cycleDiv.textContent = 
        `ë‹¤ìŒ ê²°ê³¼ ë³€ê²½ ì‹œê°: ${nextCycleTime.toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', second: '2-digit' })}`;
}

// ì´ˆê¸°í™”
function initResultDisplay() {
    if (nextCycleTimer) {
        clearInterval(nextCycleTimer);
    }
    
    // 100ë°€ë¦¬ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ (1ì´ˆ ì£¼ê¸°ë¥¼ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ì •í™•íˆ í‘œì‹œí•˜ê¸° ìœ„í•´)
    nextCycleTimer = setInterval(updateDisplay, 100); 
    
    // ì²« ì‹¤í–‰
    updateDisplay();
}

window.onload = initResultDisplay;
</script>
</body>
</html>
